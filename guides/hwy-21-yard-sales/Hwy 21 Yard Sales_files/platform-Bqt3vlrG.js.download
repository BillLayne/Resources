import{R as Xe,r as se,d as N,a as k}from"./vendors-CK7-BMz1.js";const L=Symbol.for("@ts-pattern/matcher"),Ge=Symbol.for("@ts-pattern/isVariadic"),Ee="@ts-pattern/anonymous-select-key",Te=e=>!!(e&&typeof e=="object"),ue=e=>e&&!!e[L],S=(e,t,n)=>{if(ue(e)){const r=e[L](),{matched:i,selections:s}=r.match(t);return i&&s&&Object.keys(s).forEach(o=>n(o,s[o])),i}if(Te(e)){if(!Te(t))return!1;if(Array.isArray(e)){if(!Array.isArray(t))return!1;let r=[],i=[],s=[];for(const o of e.keys()){const a=e[o];ue(a)&&a[Ge]?s.push(a):s.length?i.push(a):r.push(a)}if(s.length){if(s.length>1)throw new Error("Pattern error: Using `...P.array(...)` several times in a single pattern is not allowed.");if(t.length<r.length+i.length)return!1;const o=t.slice(0,r.length),a=i.length===0?[]:t.slice(-i.length),l=t.slice(r.length,i.length===0?1/0:-i.length);return r.every((u,m)=>S(u,o[m],n))&&i.every((u,m)=>S(u,a[m],n))&&(s.length===0||S(s[0],l,n))}return e.length===t.length&&e.every((o,a)=>S(o,t[a],n))}return Object.keys(e).every(r=>{const i=e[r];return(r in t||ue(s=i)&&s[L]().matcherType==="optional")&&S(i,t[r],n);var s})}return Object.is(t,e)},P=e=>{var t,n,r;return Te(e)?ue(e)?(t=(n=(r=e[L]()).getSelectionKeys)==null?void 0:n.call(r))!=null?t:[]:Array.isArray(e)?ae(e,P):ae(Object.values(e),P):[]},ae=(e,t)=>e.reduce((n,r)=>n.concat(t(r)),[]);function rt(...e){if(e.length===1){const[t]=e;return n=>S(t,n,()=>{})}if(e.length===2){const[t,n]=e;return S(t,n,()=>{})}throw new Error(`isMatching wasn't given the right number of arguments: expected 1 or 2, received ${e.length}.`)}function R(e){return Object.assign(e,{optional:()=>Ue(e),and:t=>p(e,t),or:t=>Je(e,t),select:t=>t===void 0?ce(e):ce(t,e)})}function Se(e){return Object.assign((t=>Object.assign(t,{[Symbol.iterator](){let n=0;const r=[{value:Object.assign(t,{[Ge]:!0}),done:!1},{done:!0,value:void 0}];return{next:()=>{var i;return(i=r[n++])!=null?i:r.at(-1)}}}}))(e),{optional:()=>Se(Ue(e)),select:t=>Se(t===void 0?ce(e):ce(t,e))})}function Ue(e){return R({[L]:()=>({match:t=>{let n={};const r=(i,s)=>{n[i]=s};return t===void 0?(P(e).forEach(i=>r(i,void 0)),{matched:!0,selections:n}):{matched:S(e,t,r),selections:n}},getSelectionKeys:()=>P(e),matcherType:"optional"})})}const st=(e,t)=>{for(const n of e)if(!t(n))return!1;return!0},it=(e,t)=>{for(const[n,r]of e.entries())if(!t(r,n))return!1;return!0};function p(...e){return R({[L]:()=>({match:t=>{let n={};const r=(i,s)=>{n[i]=s};return{matched:e.every(i=>S(i,t,r)),selections:n}},getSelectionKeys:()=>ae(e,P),matcherType:"and"})})}function Je(...e){return R({[L]:()=>({match:t=>{let n={};const r=(i,s)=>{n[i]=s};return ae(e,P).forEach(i=>r(i,void 0)),{matched:e.some(i=>S(i,t,r)),selections:n}},getSelectionKeys:()=>ae(e,P),matcherType:"or"})})}function d(e){return{[L]:()=>({match:t=>({matched:!!e(t)})})}}function ce(...e){const t=typeof e[0]=="string"?e[0]:void 0,n=e.length===2?e[1]:typeof e[0]=="string"?void 0:e[0];return R({[L]:()=>({match:r=>{let i={[t??Ee]:r};return{matched:n===void 0||S(n,r,(s,o)=>{i[s]=o}),selections:i}},getSelectionKeys:()=>[t??Ee].concat(n===void 0?[]:P(n))})})}function D(e){return typeof e=="number"}function j(e){return typeof e=="string"}function B(e){return typeof e=="bigint"}const qe=R(d(function(e){return!0})),ot=qe,$=e=>Object.assign(R(e),{startsWith:t=>{return $(p(e,(n=t,d(r=>j(r)&&r.startsWith(n)))));var n},endsWith:t=>{return $(p(e,(n=t,d(r=>j(r)&&r.endsWith(n)))));var n},minLength:t=>$(p(e,(n=>d(r=>j(r)&&r.length>=n))(t))),length:t=>$(p(e,(n=>d(r=>j(r)&&r.length===n))(t))),maxLength:t=>$(p(e,(n=>d(r=>j(r)&&r.length<=n))(t))),includes:t=>{return $(p(e,(n=t,d(r=>j(r)&&r.includes(n)))));var n},regex:t=>{return $(p(e,(n=t,d(r=>j(r)&&!!r.match(n)))));var n}}),at=$(d(j)),H=e=>Object.assign(R(e),{between:(t,n)=>H(p(e,((r,i)=>d(s=>D(s)&&r<=s&&i>=s))(t,n))),lt:t=>H(p(e,(n=>d(r=>D(r)&&r<n))(t))),gt:t=>H(p(e,(n=>d(r=>D(r)&&r>n))(t))),lte:t=>H(p(e,(n=>d(r=>D(r)&&r<=n))(t))),gte:t=>H(p(e,(n=>d(r=>D(r)&&r>=n))(t))),int:()=>H(p(e,d(t=>D(t)&&Number.isInteger(t)))),finite:()=>H(p(e,d(t=>D(t)&&Number.isFinite(t)))),positive:()=>H(p(e,d(t=>D(t)&&t>0))),negative:()=>H(p(e,d(t=>D(t)&&t<0)))}),ct=H(d(D)),K=e=>Object.assign(R(e),{between:(t,n)=>K(p(e,((r,i)=>d(s=>B(s)&&r<=s&&i>=s))(t,n))),lt:t=>K(p(e,(n=>d(r=>B(r)&&r<n))(t))),gt:t=>K(p(e,(n=>d(r=>B(r)&&r>n))(t))),lte:t=>K(p(e,(n=>d(r=>B(r)&&r<=n))(t))),gte:t=>K(p(e,(n=>d(r=>B(r)&&r>=n))(t))),positive:()=>K(p(e,d(t=>B(t)&&t>0))),negative:()=>K(p(e,d(t=>B(t)&&t<0)))}),lt=K(d(B)),ht=R(d(function(e){return typeof e=="boolean"})),ut=R(d(function(e){return typeof e=="symbol"})),dt=R(d(function(e){return e==null})),ft=R(d(function(e){return e!=null}));var Xt={__proto__:null,matcher:L,optional:Ue,array:function(...e){return Se({[L]:()=>({match:t=>{if(!Array.isArray(t))return{matched:!1};if(e.length===0)return{matched:!0};const n=e[0];let r={};if(t.length===0)return P(n).forEach(s=>{r[s]=[]}),{matched:!0,selections:r};const i=(s,o)=>{r[s]=(r[s]||[]).concat([o])};return{matched:t.every(s=>S(n,s,i)),selections:r}},getSelectionKeys:()=>e.length===0?[]:P(e[0])})})},set:function(...e){return R({[L]:()=>({match:t=>{if(!(t instanceof Set))return{matched:!1};let n={};if(t.size===0)return{matched:!0,selections:n};if(e.length===0)return{matched:!0};const r=(s,o)=>{n[s]=(n[s]||[]).concat([o])},i=e[0];return{matched:st(t,s=>S(i,s,r)),selections:n}},getSelectionKeys:()=>e.length===0?[]:P(e[0])})})},map:function(...e){return R({[L]:()=>({match:t=>{if(!(t instanceof Map))return{matched:!1};let n={};if(t.size===0)return{matched:!0,selections:n};const r=(a,l)=>{n[a]=(n[a]||[]).concat([l])};if(e.length===0)return{matched:!0};var i;if(e.length===1)throw new Error(`\`P.map\` wasn't given enough arguments. Expected (key, value), received ${(i=e[0])==null?void 0:i.toString()}`);const[s,o]=e;return{matched:it(t,(a,l)=>{const u=S(s,l,r),m=S(o,a,r);return u&&m}),selections:n}},getSelectionKeys:()=>e.length===0?[]:[...P(e[0]),...P(e[1])]})})},intersection:p,union:Je,not:function(e){return R({[L]:()=>({match:t=>({matched:!S(e,t,()=>{})}),getSelectionKeys:()=>[],matcherType:"not"})})},when:d,select:ce,any:qe,_:ot,string:at,number:ct,bigint:lt,boolean:ht,symbol:ut,nullish:dt,nonNullable:ft,instanceOf:function(e){return R(d(function(t){return n=>n instanceof t}(e)))},shape:function(e){return R(d(rt(e)))}};const Re={matched:!1,value:void 0};function Et(e){return new pe(e,Re)}class pe{constructor(t,n){this.input=void 0,this.state=void 0,this.input=t,this.state=n}with(...t){if(this.state.matched)return this;const n=t[t.length-1],r=[t[0]];let i;t.length===3&&typeof t[1]=="function"?i=t[1]:t.length>2&&r.push(...t.slice(1,t.length-1));let s=!1,o={};const a=(u,m)=>{s=!0,o[u]=m},l=!r.some(u=>S(u,this.input,a))||i&&!i(this.input)?Re:{matched:!0,value:n(s?Ee in o?o[Ee]:o:this.input,this.input)};return new pe(this.input,l)}when(t,n){if(this.state.matched)return this;const r=!!t(this.input);return new pe(this.input,r?{matched:!0,value:n(this.input,this.input)}:Re)}otherwise(t){return this.state.matched?this.state.value:t(this.input)}exhaustive(){if(this.state.matched)return this.state.value;let t;try{t=JSON.stringify(this.input)}catch{t=this.input}throw new Error(`Pattern matching error: no pattern matches value ${t}`)}run(){return this.exhaustive()}returnType(){return this}}class me extends Error{code;details;constructor(t,{message:n,cause:r,details:i={}}={}){super(n?`[${t}] ${n}`:`[${t}]`,{cause:r}),this.code=t,this.code=t,this.details=i,this.name="PplxError","captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,me)}}function ee(...e){let t;const n={},r=[];e.filter(Boolean).forEach(s=>{s instanceof me?(t=s,r.push(s.message),s.details&&Object.assign(n,{pplx_error_code:s.code,...s.details})):s instanceof Error?(t=s,r.push(s.message)):typeof s=="object"?Object.assign(n,s):r.push(s)});const i=r.join(" ");return t?{message:i,error:t,extra:n}:{message:i,extra:n}}const pt=Xe.memo(({session:e,isWindowsApp:t})=>(se.useEffect(()=>{e&&(N.setUser({id:e.id,name:e.name??"",email:e.email}),N.setGlobalContextProperty("isPro",e.isPro),N.setGlobalContextProperty("isWindowsApp",t))},[e,t]),null));pt.displayName="LoggerAgent";function te(e,{message:t,error:n,extra:r}){const i=[t,r,n];Et(e).with("error",()=>{N.logger.error(...i);try{k.addError(n,{message:t,extra:r})}catch{}}).with("warn",()=>N.logger.warn(...i)).with("log",()=>N.logger.info(...i)).with("debug",()=>N.logger.debug(...i)).with("info",()=>N.logger.info(...i)).exhaustive()}const Z={log:(...e)=>{te("debug",ee(...e))},error:(...e)=>{te("error",ee(...e))},warn:(...e)=>{te("warn",ee(...e))},debug:(...e)=>{te("debug",ee(...e))},info:(...e)=>{te("info",ee(...e))}};function Gt({ddClientToken:e,version:t,env:n,debug:r,sessionSampleRate:i,service:s="web-nextjs"}){N.init({clientToken:e,site:"datadoghq.com",service:s,env:n,version:t,sessionSampleRate:i,forwardErrorsToLogs:!0,forwardConsoleLogs:["warn","error","info"],beforeSend:o=>o.http?.url.includes("reddit.com")||(o.http?.status_code===0&&(o.status="warn"),o.error?.handling==="unhandled"&&o.message?.includes("Script error.")&&!o.error?.cause)?!1:o.status==="error"||o.status==="warn"||o.status==="info"}),r&&(N._setDebug(!0),N.onReady(()=>{N.logger.setHandler("http")}))}function Jt(e){Object.entries(e).forEach(([t,n])=>{N.setGlobalContextProperty(t,n)})}let we=!1;const qt=()=>{const e=se.useRef(new URL(performance.getEntriesByType("navigation").at(0)?.name??"").pathname);document.visibilityState!=="visible"&&(we=!0);const t=se.useCallback((n=0)=>{let r="ttv";!we&&e.current===window.location.pathname&&(r="fttv",we=!0),k.addDurationVital(r,{startTime:performance.timeOrigin+n,duration:performance.now()-n})},[]);return se.useMemo(()=>({markTTV:t}),[t])},ze="web.custom_metrics";function gt(e,t,n){Z.info(ze,{metricName:e,duration:t,...n})}function mt(e={},{transport:t=gt,nowFromTimeOrigin:n=performance.now()}={}){const r={...e},i=new Set,s=[];function o(l,u={}){const m=performance.now()-n,_={metricName:l,duration:m};return s.push(_),t(l,m,{...r,...u,startTime:n+performance.timeOrigin}),_}function a(l,u){return i.has(l)?s.find(m=>m.metricName===l):(i.add(l),o(l,u))}return{addTimingOnce:a,addTiming:o,getEvents(){return s},setGlobalContext(l){Object.assign(r,l)},getStartTimeFromTimeOrigin(){return n},getAbsoluteStartTime(){return n+performance.timeOrigin}}}function zt(e,{verbose:t,raiseOnError:n,onlyUseRum:r=!0,...i}){const{duration:s,startTime:o,...a}=i;k.addDurationVital(e,{startTime:o,duration:s,context:a}),r||Z.info(ze,{metricName:e,...i})}function Fe(e={},t={}){const n=Date.now();return mt(e,{...t,transport:(r,i,s)=>{k.addDurationVital(r,{startTime:n,duration:i,context:s})}})}function Yt(e){Object.entries(e).forEach(([t,n])=>{k.setGlobalContextProperty(t,n)})}function Qt(e,t={}){k.addAction(e,t)}function Zt(e){if(!e)return;const{ddApplicationId:t,ddClientToken:n,version:r,env:i,debug:s}=e;!t||!n||(k.init({applicationId:t,clientToken:n,site:"datadoghq.com",service:"web-nextjs",env:i,version:r,sessionSampleRate:e.sessionSampleRate,sessionReplaySampleRate:e.sessionReplaySampleRate,defaultPrivacyLevel:"mask-user-input",allowedTracingUrls:[/\.perplexity\.ai/,"http://localhost:3000"]}),s&&k._setDebug(!0))}const _t=Xe.memo(({session:e,isWindowsApp:t})=>(se.useEffect(()=>{e&&(k.setUser({id:e.id,name:e.name??"",email:e.email}),k.setGlobalContextProperty("isPro",e.isPro),k.setGlobalContextProperty("isWindowsApp",t))},[e,t]),null));_t.displayName="MetricsAgent";const Ye="2.18",Qe="default",vt="server",wt="mweb",yt="windowsapp",Tt="X-Perplexity-Request-Reason";var St=Object.defineProperty,Rt=(e,t,n)=>t in e?St(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,he=(e,t,n)=>Rt(e,typeof t!="symbol"?t+"":t,n);class je extends Error{constructor(t,n){super(t),he(this,"type"),he(this,"field"),he(this,"value"),he(this,"line"),this.name="ParseError",this.type=n.type,this.field=n.field,this.value=n.value,this.line=n.line}}function ye(e){}function Ct(e){const{onEvent:t=ye,onError:n=ye,onRetry:r=ye,onComment:i}=e;let s="",o=!0,a,l="",u="";function m(c){const f=o?c.replace(/^\xEF\xBB\xBF/,""):c,[E,M]=bt(`${s}${f}`);for(const X of E)_(X);s=M,o=!1}function _(c){if(c===""){C();return}if(c.startsWith(":")){i&&i(c.slice(c.startsWith(": ")?2:1));return}const f=c.indexOf(":");if(f!==-1){const E=c.slice(0,f),M=c[f+1]===" "?2:1,X=c.slice(f+M);v(E,X,c);return}v(c,"",c)}function v(c,f,E){switch(c){case"event":u=f;break;case"data":l=`${l}${f}
`;break;case"id":a=f.includes("\0")?void 0:f;break;case"retry":/^\d+$/.test(f)?r(parseInt(f,10)):n(new je(`Invalid \`retry\` value: "${f}"`,{type:"invalid-retry",value:f,line:E}));break;default:n(new je(`Unknown field "${c.length>20?`${c.slice(0,20)}â€¦`:c}"`,{type:"unknown-field",field:c,value:f,line:E}));break}}function C(){l.length>0&&t({id:a,event:u||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),a=void 0,l="",u=""}function b(c={}){s&&c.consume&&_(s),a=void 0,l="",u="",s=""}return{feed:m,reset:b}}function bt(e){const t=[];let n="";const r=e.length;for(let i=0;i<r;i++){const s=e[i];s==="\r"&&e[i+1]===`
`?(t.push(n),n="",i++):s==="\r"||s===`
`?(t.push(n),n=""):n+=s}return[t,n]}class Be extends Event{constructor(t,n){var r,i;super(t),this.code=(r=n?.code)!=null?r:void 0,this.message=(i=n?.message)!=null?i:void 0}[Symbol.for("nodejs.util.inspect.custom")](t,n,r){return r($e(this),n)}[Symbol.for("Deno.customInspect")](t,n){return t($e(this),n)}}function Ot(e){const t=globalThis.DOMException;return typeof t=="function"?new t(e,"SyntaxError"):new SyntaxError(e)}function Ce(e){return e instanceof Error?"errors"in e&&Array.isArray(e.errors)?e.errors.map(Ce).join(", "):"cause"in e&&e.cause instanceof Error?`${e}: ${Ce(e.cause)}`:e.message:`${e}`}function $e(e){return{type:e.type,message:e.message,code:e.code,defaultPrevented:e.defaultPrevented,cancelable:e.cancelable,timeStamp:e.timeStamp}}var Ze=e=>{throw TypeError(e)},Ie=(e,t,n)=>t.has(e)||Ze("Cannot "+n),h=(e,t,n)=>(Ie(e,t,"read from private field"),n?n.call(e):t.get(e)),w=(e,t,n)=>t.has(e)?Ze("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),g=(e,t,n,r)=>(Ie(e,t,"write to private field"),t.set(e,n),n),F=(e,t,n)=>(Ie(e,t,"access private method"),n),O,G,J,de,ge,ie,Y,oe,V,q,Q,z,ne,I,be,Oe,Le,Ke,Ae,Ne,re,Pe,xe;class fe extends EventTarget{constructor(t,n){var r,i;super(),w(this,I),this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,w(this,O),w(this,G),w(this,J),w(this,de),w(this,ge),w(this,ie),w(this,Y),w(this,oe,null),w(this,V),w(this,q),w(this,Q,null),w(this,z,null),w(this,ne,null),w(this,Oe,async s=>{var o;h(this,q).reset();const{body:a,redirected:l,status:u,headers:m}=s;if(u===204){F(this,I,re).call(this,"Server sent HTTP 204, not reconnecting",204),this.close();return}if(l?g(this,J,new URL(s.url)):g(this,J,void 0),u!==200){F(this,I,re).call(this,`Non-200 status code (${u})`,u);return}if(!(m.get("content-type")||"").startsWith("text/event-stream")){F(this,I,re).call(this,'Invalid content type, expected "text/event-stream"',u);return}if(h(this,O)===this.CLOSED)return;g(this,O,this.OPEN);const _=new Event("open");if((o=h(this,ne))==null||o.call(this,_),this.dispatchEvent(_),typeof a!="object"||!a||!("getReader"in a)){F(this,I,re).call(this,"Invalid response body, expected a web ReadableStream",u),this.close();return}const v=new TextDecoder,C=a.getReader();let b=!0;do{const{done:c,value:f}=await C.read();f&&h(this,q).feed(v.decode(f,{stream:!c})),c&&(b=!1,h(this,q).reset(),F(this,I,Pe).call(this))}while(b)}),w(this,Le,s=>{g(this,V,void 0),!(s.name==="AbortError"||s.type==="aborted")&&F(this,I,Pe).call(this,Ce(s))}),w(this,Ae,s=>{typeof s.id=="string"&&g(this,oe,s.id);const o=new MessageEvent(s.event||"message",{data:s.data,origin:h(this,J)?h(this,J).origin:h(this,G).origin,lastEventId:s.id||""});h(this,z)&&(!s.event||s.event==="message")&&h(this,z).call(this,o),this.dispatchEvent(o)}),w(this,Ne,s=>{g(this,ie,s)}),w(this,xe,()=>{g(this,Y,void 0),h(this,O)===this.CONNECTING&&F(this,I,be).call(this)});try{if(t instanceof URL)g(this,G,t);else if(typeof t=="string")g(this,G,new URL(t,Lt()));else throw new Error("Invalid URL")}catch{throw Ot("An invalid or illegal string was specified")}g(this,q,Ct({onEvent:h(this,Ae),onRetry:h(this,Ne)})),g(this,O,this.CONNECTING),g(this,ie,3e3),g(this,ge,(r=n?.fetch)!=null?r:globalThis.fetch),g(this,de,(i=n?.withCredentials)!=null?i:!1),F(this,I,be).call(this)}get readyState(){return h(this,O)}get url(){return h(this,G).href}get withCredentials(){return h(this,de)}get onerror(){return h(this,Q)}set onerror(t){g(this,Q,t)}get onmessage(){return h(this,z)}set onmessage(t){g(this,z,t)}get onopen(){return h(this,ne)}set onopen(t){g(this,ne,t)}addEventListener(t,n,r){const i=n;super.addEventListener(t,i,r)}removeEventListener(t,n,r){const i=n;super.removeEventListener(t,i,r)}close(){h(this,Y)&&clearTimeout(h(this,Y)),h(this,O)!==this.CLOSED&&(h(this,V)&&h(this,V).abort(),g(this,O,this.CLOSED),g(this,V,void 0))}}O=new WeakMap,G=new WeakMap,J=new WeakMap,de=new WeakMap,ge=new WeakMap,ie=new WeakMap,Y=new WeakMap,oe=new WeakMap,V=new WeakMap,q=new WeakMap,Q=new WeakMap,z=new WeakMap,ne=new WeakMap,I=new WeakSet,be=function(){g(this,O,this.CONNECTING),g(this,V,new AbortController),h(this,ge)(h(this,G),F(this,I,Ke).call(this)).then(h(this,Oe)).catch(h(this,Le))},Oe=new WeakMap,Le=new WeakMap,Ke=function(){var e;const t={mode:"cors",redirect:"follow",headers:{Accept:"text/event-stream",...h(this,oe)?{"Last-Event-ID":h(this,oe)}:void 0},cache:"no-store",signal:(e=h(this,V))==null?void 0:e.signal};return"window"in globalThis&&(t.credentials=this.withCredentials?"include":"same-origin"),t},Ae=new WeakMap,Ne=new WeakMap,re=function(e,t){var n;h(this,O)!==this.CLOSED&&g(this,O,this.CLOSED);const r=new Be("error",{code:t,message:e});(n=h(this,Q))==null||n.call(this,r),this.dispatchEvent(r)},Pe=function(e,t){var n;if(h(this,O)===this.CLOSED)return;g(this,O,this.CONNECTING);const r=new Be("error",{code:t,message:e});(n=h(this,Q))==null||n.call(this,r),this.dispatchEvent(r),g(this,Y,setTimeout(h(this,xe),h(this,ie)))},xe=new WeakMap,fe.CONNECTING=0,fe.OPEN=1,fe.CLOSED=2;function Lt(){const e="document"in globalThis?globalThis.document:void 0;return e&&typeof e=="object"&&"baseURI"in e&&typeof e.baseURI=="string"?e.baseURI:void 0}class W extends me{name="FetcherError"}const At="TimeoutError",Ve=2,Nt=1200,Pt=e=>{const t=typeof window>"u",n=new URL(e),r=n.searchParams;return r.get("version")||r.set("version",Ye),r.get("source")||r.set("source",t?vt:Qe),n};function xt(e=Nt){try{const t=globalThis.navigator.userAgent.includes("Mobile")&&!globalThis.navigator.userAgent.includes("iPad");let n="unknown",r=10;return globalThis.navigator.connection&&(n=globalThis.navigator.connection.type,r=globalThis.navigator.connection.downlink),t||r<1||n==="cellular"?e*2:e}catch{return e}}const Ut=e=>{switch(e){case 400:case 403:case 404:return!1;case 401:case 409:return!0;case 500:case 502:case 429:return!0;default:return!1}},It=e=>{if(!e)return 0;const t=parseInt(e,10);if(!isNaN(t))return Math.max(0,t*1e3);const r=new Date(e).getTime();return isNaN(r)?0:Math.max(0,r-Date.now())},kt=(e,t,n)=>n+e*Math.pow(2,t),Mt=async({resource:e,options:t={},timeoutMs:n=xt(),method:r="GET",body:i,numRetries:s=0,backOffTime:o=1e3,reason:a})=>{const l={...t,method:r,body:i},u=new Headers(l.headers);u.set(Tt,a);let m=()=>null;if(n&&(m=()=>{const f=new DOMException(`fetch ${e} timed out (${n}ms)`,At),E=new AbortController;return l.signal=E.signal,setTimeout(()=>E.abort(f),n)}),s>Ve){const f=new W("FETCHER_MAX_RETRIES_EXCEEDED",{details:{resource:e,numRetries:s,maxRetries:Ve}});Z.error(f)}let _=null,v,C=o,b=0,c=0;do{s>0&&c>0&&await new Promise(E=>setTimeout(E,C));const f=m();b=0,v=void 0;try{if(u.set("X-Perplexity-Request-Try-Number",String(c+1)),u.set("X-Perplexity-Request-Endpoint",String(e)),_=await fetch(e,{...l,headers:u}),clearTimeout(f),!_.ok&&Ut(_.status))b=It(_.headers.get("Retry-After"));else break}catch(E){v=E}clearTimeout(f),C=kt(o,c,b),++c}while(c<=s);if(!v&&!_.ok)if(_.status===403&&_.headers.get("cf-mitigated")?.includes("challenge"))v=new W("FETCHER_CLOUDFLARE_403_ERROR",{message:"Cloudflare 403 error"});else{const E=(await _.clone().text()).trimStart();(E.startsWith("<!DOCTYPE html")||E.startsWith("<html"))&&(v=new W("FETCHER_HTML_STATUS_ERROR",{message:`${_.status} error`,details:{html:E,status:_.status}}))}if(v)throw Z.log(`${l.method} ${e} exception`,v),v._fetchMethod=l.method,v._fetchResource=e,v;return _},Dt=10*60*1e3;async function Ht({url:e,params:t,handlers:n,legacyEvents:r={},headers:i={},signal:s,metrics:o={},timer:a}){const l=r.message??"message",u=r.endOfStream??"end_of_stream",m=r.message&&r.endOfStream,{now:_,...v}=o;a?a.setGlobalContext({path:e.pathname,...v}):a=Fe({path:e.pathname,...v},{nowFromTimeOrigin:performance.now()});const{addTiming:C,addTimingOnce:b}=a;return C("web.sse.start"),new Promise((c,f)=>{const E=new fe(e,{withCredentials:!0,fetch:(T,A)=>fetch(T,{...A,method:"POST",body:t?JSON.stringify(t):void 0,credentials:"include",signal:s,headers:{"content-type":"application/json",...A?.headers??{},...i}})});let M,X;function nt(){X?X=void 0:X=Fe({path:e.pathname})}function _e(){clearTimeout(M),M=setTimeout(()=>{try{E.close()}catch{}finally{ve()}f(new W("FETCHER_SSE_CHUNK_TIMEOUT",{details:{submitParams:t}}))},Dt)}function le(T){clearTimeout(M);try{E.close()}catch{}finally{ve()}T instanceof W?f(T):f(new W("FETCHER_SSE_ERROR",{cause:T,message:"An error occurred while streaming",details:{submitParams:t}}))}const ke=T=>{const A=()=>!navigator.onLine||T.message==="network error";let x="FETCHER_SSE_ERROR";A()?x="FETCHER_SSE_OFFLINE_ERROR":T.code?T.code===403&&(x="FETCHER_CLOUDFLARE_403_ERROR"):x="FETCHER_SSE_NO_STATUS_CODE_ERROR",le(new W(x,{cause:T,details:{code:x,message:T.message,type:T.type,submitParams:t}}))},Me=()=>{_e(),C("web.sse.connection_opened"),n.open?.()},De=T=>{let A;try{b("web.sse.first_message_seen"),nt(),_e(),A=JSON.parse(T.data)}catch(x){return le(new W("FETCHER_SSE_CHUNK_PROCESSING_ERROR",{cause:x,details:{submitParams:t}}))}n.message(A)},He=T=>{let A;try{b("web.sse.first_message_seen"),clearTimeout(M);try{E.close()}catch{}finally{ve()}A=JSON.parse(T.data)}catch(x){return le(new W("FETCHER_SSE_EOS_ERROR",{cause:x,details:{submitParams:t}}))}m&&n.message(A),C("web.sse.end_of_stream"),c()},We=T=>{let A;try{A=JSON.parse(T.data)}catch(x){return le(new W("FETCHER_SSE_INFO_CHUNK_PARSE_ERROR",{cause:x,details:{submitParams:t}}))}n.info?.(A)};E.addEventListener("error",ke),E.addEventListener("open",Me),E.addEventListener(l,De),E.addEventListener(u,He),E.addEventListener("info",We);const ve=()=>{E.removeEventListener("error",ke),E.removeEventListener("open",Me),E.removeEventListener(l,De),E.removeEventListener(u,He),E.removeEventListener("info",We)};_e()}).catch(c=>{throw c instanceof Error&&(c.cause?.code??0)>0||Z.error("SSE error",c,{path:e.pathname}),c})}const Wt=(e,t)=>{const n=e.replace(/\/+$/,""),r=t.replace(/^\/+/,"");return new URL(r,n).toString()},Ft=(e,t)=>e?wt:t?yt:Qe;var y={};const jt="https://testing.i.perplexity.ai",Bt=e=>{const t=new URL(e);return globalThis.location.hostname.includes("localhost")||(t.protocol=globalThis.location.protocol,t.hostname=globalThis.location.hostname),t.toString()};function et(){return y.NEXT_PUBLIC_REST_ASYNC_SERVER_URL||Bt(jt)}const $t=()=>{const e={};return y.NEXT_PUBLIC_CF_ACCESS_ID&&(e["CF-Access-Client-Id"]=y.NEXT_PUBLIC_CF_ACCESS_ID),y.NEXT_PUBLIC_CF_ACCESS_SECRET&&(e["CF-Access-Client-Secret"]=y.NEXT_PUBLIC_CF_ACCESS_SECRET),y.NEXT_PUBLIC_PPL_DEV_HEADER_NAME&&y.NEXT_PUBLIC_PPL_DEV_HEADER_TOKEN&&(e[y.NEXT_PUBLIC_PPL_DEV_HEADER_NAME]=y.NEXT_PUBLIC_PPL_DEV_HEADER_TOKEN),y.PPL_VERCEL_SSR_CLIENT_HEADER_NAME&&y.PPL_VERCEL_SSR_CLIENT_HEADER_TOKEN&&(e[y.PPL_VERCEL_SSR_CLIENT_HEADER_NAME]=y.PPL_VERCEL_SSR_CLIENT_HEADER_TOKEN),y.SERVER_SIDE_CLIENT_TOKEN_HEADER_NAME&&y.SERVER_SIDE_CLIENT_TOKEN_HEADER_TOKEN&&(e[y.SERVER_SIDE_CLIENT_TOKEN_HEADER_NAME]=y.SERVER_SIDE_CLIENT_TOKEN_HEADER_TOKEN),e},U={jwt:null,ttl:0,promise:void 0},tt=async()=>{if(U.ttl>Date.now())return U.jwt;try{U.promise=U.promise??fetch("/api/auth/token",{headers:{"X-Token-Type":"Perplexity-JWT"}}).then(e=>e.json()).then(e=>e.perplexity_jwt),U.jwt=await U.promise,U.ttl=Date.now()+1e3*60*9}catch(e){U.jwt=null,U.ttl=0,Z.warn("Error getting dev token:",e)}finally{U.promise=void 0}return U.jwt},Kt=({clientHeaders:e,isMobile:t,isWindowsApp:n})=>{const r=Ft(t,n),i=e instanceof Headers?new Headers(e):new Headers(Object.entries(e??{}).filter(o=>o[1]!==void 0).map(([o,a])=>[o,Array.isArray(a)?a.join(", "):a])),s=new Headers({...$t(),"X-App-ApiClient":r,"X-App-ApiVersion":Ye});return i.forEach((o,a)=>{s.set(a,o)}),s};async function en({urlPath:e,timeoutMs:t,method:n,body:r,headers:i,baseUrlOverride:s,redirect:o,numRetries:a,backOffTime:l,reason:u}){const m=navigator.userAgent.includes("Mobile"),_=navigator.userAgent.includes("WindowsApp"),v=Kt({clientHeaders:i,isMobile:m,isWindowsApp:_}),C={headers:v,redirect:o,credentials:"same-origin"},b=globalThis.location.hostname.includes("localhost")??!1,c=y.NEXT_PUBLIC_USE_TOKEN_AUTH_FOR_SOCKET;if((b||c)&&C.headers){const M=await tt();v.set("authorization",`Bearer ${M}`)}b&&(C.credentials="include");const f=s??et(),E=Pt(Wt(f,e));return Mt({resource:E,options:C,timeoutMs:t,method:n,body:r,numRetries:a,backOffTime:l,reason:u})}async function tn({url:e,headers:t,...n}){const r=new URL(e,et()),i=globalThis.location.hostname.includes("localhost")??!1,s=y.NEXT_PUBLIC_USE_TOKEN_AUTH_FOR_SOCKET,o={};let a="";return(i||s)&&(a=`Bearer ${await tt()}`,o.authorization=a),Ht({url:r,headers:{...t,...o},...n})}export{Et as $,W as F,pt as L,_t as M,Xt as N,me as P,en as a,Fe as b,zt as c,Ft as d,Gt as e,Jt as f,et as g,Yt as h,Zt as i,Mt as j,Z as l,Qt as r,tn as s,qt as u};
//# sourceMappingURL=platform-Bqt3vlrG.js.map
